@model SporSalonuYonetim.Models.YapayZekaSonuc

@{
    ViewData["Title"] = "Yapay Zekâ Öneri Sonucu";
    // Satır sonlarını korumak için
    string icerik = (Model?.OneriMetni ?? string.Empty)
        .Replace("\r\n", "\n")
        .Replace("\n", "<br />");
}

<div class="row justify-content-center mt-4">
    <div class="col-lg-9">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="mb-0">Yapay Zekâ Öneri Sonucu</h3>
            <div>
                <a asp-action="Index" class="btn btn-outline-secondary btn-sm">
                    Yeni Öneri Al
                </a>
                <a asp-action="Gecmis" class="btn btn-outline-primary">
                    Geçmiş Önerilerim
                </a>
            </div>
        </div>

        <div class="card shadow-sm mb-3">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <span>Oluşturulan Kişisel Plan</span>
                <button type="button" class="btn btn-light btn-sm" onclick="copyPlan()">
                    Metni Kopyala
                </button>
            </div>
            <div class="card-body" id="aiPlanContainer">
                @if (string.IsNullOrWhiteSpace(Model?.OneriMetni))
                {
                    <p class="text-muted mb-0">
                        Herhangi bir içerik üretilemedi.
                    </p>
                }
                else
                {
                    <div style="white-space: normal; font-size: 0.98rem;">
                        @Html.Raw(icerik)
                    </div>
                }
            </div>
        </div>

        <div class="alert alert-info small">
            <strong>Bilgi:</strong>
            Bu plan, önce Google Gemini modeli üzerinden oluşturulmaya çalışılır.
            Gemini servisinin kota/yoğunluk durumuna göre gerektiğinde sistemin yerleşik
            kural tabanlı öneri motoru devreye girer. Böylece kullanıcı her durumda
            kişisel bir egzersiz/beslenme önerisi alabilir.
        </div>

    </div>
</div>

@section Scripts {
    <script>
        function copyPlan() {
            const container = document.getElementById("aiPlanContainer");
            if (!container) return;

            // HTML içindeki <br> vb. etiketleri yeni satıra çevirerek kopyalayalım
            const tempElement = document.createElement("div");
            tempElement.innerHTML = container.innerHTML;
            const text = tempElement.innerText || tempElement.textContent || "";

            navigator.clipboard.writeText(text)
                .then(() => {
                    alert("Plan panoya kopyalandı.");
                })
                .catch(() => {
                    alert("Metin kopyalanırken bir sorun oluştu.");
                });
        }
    </script>
}
