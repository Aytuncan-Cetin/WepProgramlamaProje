@{
    ViewData["Title"] = "Antrenör Müsaitlik Takvimi";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<h2 class="mt-3">@ViewBag.AntrenorAd - Müsaitlik Takvimi</h2>
<p class="text-muted">
    Bu ekranda seçili antrenör için haftalık müsaitlik saatlerini
    takvim üzerinde tanımlayabilir ve silebilirsiniz.
</p>
<hr />

<div id="calendar"></div>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        var antrenorId = @ViewBag.AntrenorId;
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            locale: 'tr',
            slotMinTime: '07:00:00',
            slotMaxTime: '23:00:00',
            selectable: true,
            editable: false, // şimdilik sadece ekle/sil

            events: '/AdminMusaitlik/GetEvents?antrenorId=' + antrenorId,

            select: function (info) {
                if (confirm("Bu zaman aralığını antrenör için MÜSAİT olarak eklemek istiyor musun?")) {

                    fetch('/AdminMusaitlik/AddEvent', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            antrenorId: antrenorId,
                            start: info.startStr,
                            end: info.endStr
                        })
                    }).then(response => {
                        if (response.ok) {
                            calendar.refetchEvents();
                        } else {
                            alert("Müsaitlik eklenirken bir hata oluştu.");
                        }
                    });
                }
            },

            eventClick: function (info) {
                if (confirm("Bu müsaitlik kaydını silmek istiyor musun?")) {
                    fetch('/AdminMusaitlik/DeleteEvent', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id: info.event.id })
                    }).then(response => {
                        if (response.ok) {
                            info.event.remove();
                        } else {
                            alert("Silme sırasında hata oluştu.");
                        }
                    });
                }
            }
        });

        calendar.render();
    });
</script>
